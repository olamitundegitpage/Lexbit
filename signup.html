<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexbit - Get Started</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="images/—Pngtree—vector coins icon_3788228.png" type="image/png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

    <header class="bg-white shadow fixed top-0 left-0 w-full bg-white shadow z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-coins text-2xl text-yellow-400"></i>
                <a href="Lexbit.html"><h1 class="text-2xl font-bold">LexBit</h1></a>
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="#" class="text-gray-600 hover:text-blue-600">About Us</a>
                <a href="#" class="text-gray-600 hover:text-blue-600">Testimonials</a>
                <a href="#" class="text-gray-600 hover:text-blue-600">Support</a>
            </nav>
            <div class="flex space-x-4">
                <a href="login.html" class="px-4 py-2 text-blue-600 border border-blue-600 rounded-md hover:bg-blue-50">Login</a>
                <a class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" href="signup.html">Sign up</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-gray-600">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </header>

    <div class="w-full max-w-md bg-white rounded-xl mt-20 shadow-md overflow-hidden">
        <!-- Form Header -->
        <div class="bg-blue-600 py-6 px-8 text-center">
            <h1 class="text-2xl font-bold text-white">Join Lexbit</h1>
            <p class="text-blue-100 mt-2">Create your account to start investing in crypto.</p>
        </div>
        
        <!-- Form Content -->
        <form id="signupForm" class="p-8 space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                    <input type="text" id="firstName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                    <p id="firstNameError" class="text-red-500 text-xs mt-1 hidden">Please enter your first name</p>
                </div>
                <div>
                    <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                    <input type="text" id="lastName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                    <p id="lastNameError" class="text-red-500 text-xs mt-1 hidden">Please enter your last name</p>
                </div>
            </div>
            
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <p id="emailError" class="text-red-500 text-xs mt-1 hidden">Please enter a valid email address</p>
            </div>
            
            <div>
                <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <p id="phoneError" class="text-red-500 text-xs mt-1 hidden">Please enter a valid phone number</p>
            </div>
            
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Password" required>
                <p id="passwordError" class="text-red-500 text-xs mt-1 hidden">Password must be at least 8 characters</p>
            </div>

            <div>
                <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                <input type="password" id="confirmPassword" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Confirm Password" required>
                <p id="confirmPasswordError" class="text-red-500 text-xs mt-1 hidden">Passwords do not match</p>
            </div>

            <div>
                <label for="referralCode" class="block text-sm font-medium text-gray-700 mb-1">Referral Code (Optional)</label>
                <div class="relative">
                    <input type="text" id="referralCode" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter referral code">
                    <div id="referralStatus" class="absolute right-3 top-1/2 transform -translate-y-1/2 hidden">
                        <i class="fas fa-check-circle text-green-500"></i>
                    </div>
                </div>
                <p id="referralHelp" class="text-xs text-gray-500 mt-1">If someone referred you, enter their code here</p>
                <p id="referralError" class="text-red-500 text-xs mt-1 hidden">Invalid referral code</p>
            </div>
            
            <div class="flex items-center">
                <input id="terms" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500" required>
                <label for="terms" class="ml-2 block text-sm text-gray-700">I accept the <a href="terms.html" class="text-blue-600 hover:underline">Terms and Conditions</a></label>
                <p id="termsError" class="text-red-500 text-xs mt-1 hidden">You must accept the terms</p>
            </div>
            
            <button type="submit" class="w-full text-center bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 font-medium transition-colors flex items-center justify-center">
                <span id="buttonText">Get Started</span>
                <div id="buttonSpinner" class="spinner ml-2 hidden"></div>
            </button>
            
            <!-- API Response Message -->
            <div id="apiResponse" class="hidden mt-4 p-3 rounded-md text-center"></div>
        </form>
    </div>

    <script>
        // API endpoint
        const API_URL = 'https://lexbit.onrender.com/register';
        
        // Check for referral code in URL parameters
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            
            if (refCode) {
                document.getElementById('referralCode').value = refCode;
                document.getElementById('referralStatus').classList.remove('hidden');
                document.getElementById('referralHelp').textContent = 'Referral code applied from your invitation link!';
                document.getElementById('referralHelp').classList.add('text-green-600');
            }
        });

        // Form submission handler
        document.getElementById('signupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Reset error messages
            document.querySelectorAll('[id$="Error"]').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Hide previous API response
            document.getElementById('apiResponse').classList.add('hidden');
            
            let isValid = true;

            // Validate First Name
            const firstName = document.getElementById('firstName').value.trim();
            if (firstName === '') {
                document.getElementById('firstNameError').classList.remove('hidden');
                isValid = false;
            }

            // Validate Last Name
            const lastName = document.getElementById('lastName').value.trim();
            if (lastName === '') {
                document.getElementById('lastNameError').classList.remove('hidden');
                isValid = false;
            }

            // Validate Email
            const email = document.getElementById('email').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                document.getElementById('emailError').classList.remove('hidden');
                isValid = false;
            }

            // Validate Phone (simple validation)
            const phone = document.getElementById('phone').value.trim();
            const phoneRegex = /^[\d\s\-+()]{10,}$/;
            if (!phoneRegex.test(phone)) {
                document.getElementById('phoneError').classList.remove('hidden');
                isValid = false;
            }

            // Validate Password
            const password = document.getElementById('password').value;
            if (password.length < 8) {
                document.getElementById('passwordError').classList.remove('hidden');
                isValid = false;
            }

            // Validate Confirm Password
            const confirmPassword = document.getElementById('confirmPassword').value;
            if (confirmPassword !== password) {
                document.getElementById('confirmPasswordError').classList.remove('hidden');
                isValid = false;
            }

            // Validate Terms checkbox
            if (!document.getElementById('terms').checked) {
                document.getElementById('termsError').classList.remove('hidden');
                isValid = false;
            }

            if (!isValid) {
                return false;
            }

            // Show loading state
            const submitButton = document.querySelector('button[type="submit"]');
            const buttonText = document.getElementById('buttonText');
            const buttonSpinner = document.getElementById('buttonSpinner');
            
            buttonText.textContent = 'Creating Account...';
            buttonSpinner.classList.remove('hidden');
            submitButton.disabled = true;

            try {
                // Get referral code
                const referralCode = document.getElementById('referralCode').value.trim();
                
                // Prepare data for API
                const userData = {
                    first_name: firstName,
                    last_name: lastName,
                    email: email,
                    phone_number: phone,
                    password: password,
                    role: "user"
                };

                // Add referral code if provided
                if (referralCode) {
                    userData.referral_code = referralCode;
                }

                // Send data to API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'accept': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();
                
                // Show API response
                const apiResponse = document.getElementById('apiResponse');
                apiResponse.classList.remove('hidden');
                
                if (response.ok) {
                    // Success
                    apiResponse.classList.add('bg-green-100', 'text-green-700');
                    apiResponse.textContent = 'Account created successfully! Redirecting to login...';
                    
                    // Redirect to login after a short delay
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    // Error from API
                    apiResponse.classList.add('bg-red-100', 'text-red-700');
                    
                    // Handle different error cases
                    if (response.status === 400) {
                        if (data.message === "User already exists") {
                            apiResponse.textContent = 'An account with this email already exists. Please login instead.';
                        } else if (data.detail && Array.isArray(data.detail)) {
                            // Handle validation errors
                            const errorMessages = data.detail.map(error => error.msg).join(', ');
                            apiResponse.textContent = errorMessages || 'Please check your input and try again.';
                        } else {
                            apiResponse.textContent = data.message || 'Registration failed. Please try again.';
                        }
                    } else {
                        apiResponse.textContent = data.message || 'Registration failed. Please try again.';
                    }
                    
                    // Reset button state
                    buttonText.textContent = 'Get Started';
                    buttonSpinner.classList.add('hidden');
                    submitButton.disabled = false;
                }
            } catch (error) {
                console.error('Error:', error);
                
                // Show error message
                const apiResponse = document.getElementById('apiResponse');
                apiResponse.classList.remove('hidden');
                apiResponse.classList.add('bg-red-100', 'text-red-700');
                apiResponse.textContent = 'Network error. Please check your connection and try again.';
                
                // Reset button state
                buttonText.textContent = 'Get Started';
                buttonSpinner.classList.add('hidden');
                submitButton.disabled = false;
            }
        });

        // Real-time validation for password matching
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;
            const errorElement = document.getElementById('confirmPasswordError');
            
            if (confirmPassword !== password && confirmPassword.length > 0) {
                errorElement.classList.remove('hidden');
            } else {
                errorElement.classList.add('hidden');
            }
        });

        // Real-time validation for password length
        document.getElementById('password').addEventListener('input', function() {
            const errorElement = document.getElementById('passwordError');
            
            if (this.value.length > 0 && this.value.length < 8) {
                errorElement.classList.remove('hidden');
            } else {
                errorElement.classList.add('hidden');
            }
        });

        // Show checkmark when referral code is entered
        document.getElementById('referralCode').addEventListener('input', function() {
            const statusElement = document.getElementById('referralStatus');
            if (this.value.trim().length > 0) {
                statusElement.classList.remove('hidden');
            } else {
                statusElement.classList.add('hidden');
            }
        });
    </script>
</body>
</html>